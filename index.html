<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DreamWhispeAi - å¬è§æ¢¦çš„ä½è¯­</title>
    
    <!-- æµè§ˆå™¨å›¾æ ‡ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ™</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ™</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9279583389810634"
     crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Nunito:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { dream: { dark: '#1A1625', purple: '#4F46E5', light: '#A78BFA', pink: '#F472B6' } },
                    fontFamily: { serif: ['"Noto Serif SC"', 'serif'], sans: ['"Nunito"', 'sans-serif'] },
                    animation: { 'float': 'float 6s ease-in-out infinite', 'slide-up': 'slideUp 0.5s ease-out' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background: linear-gradient(135deg, #1e1b4b 0%, #4c1d95 50%, #831843 100%); min-height: 100vh; color: white; font-family: 'Nunito', sans-serif; overflow-x: hidden; background-attachment: fixed; }
        .glass-panel { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.08); transition: all 0.3s ease; }
        .glass-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-5px); border-color: rgba(244, 114, 182, 0.3); }
        .glass-input { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); outline: none; transition: 0.3s; }
        .glass-input:focus { border-color: rgba(244, 114, 182, 0.5); box-shadow: 0 0 15px rgba(244, 114, 182, 0.2); }
        .btn-gradient { background: linear-gradient(90deg, #ec4899 0%, #8b5cf6 100%); transition: all 0.3s ease; }
        .btn-gradient:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(236, 72, 153, 0.4); }
        .page-section { display: none; animation: slideUp 0.5s ease-out; }
        .page-section.active { display: block; }
        
        /* ä¿®å¤å±‚çº§æ˜¾ç¤ºé”™è¯¯ */
        #toast { visibility: hidden; min-width: 220px; background: rgba(255, 255, 255, 0.95); color: #4c1d95; text-align: center; border-radius: 50px; padding: 12px 24px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); opacity: 0; transition: 0.3s; font-weight: bold; }
        #toast.show { visibility: visible; opacity: 1; bottom: 50px; }
        
        .modal { display: none; position: fixed; z-index: 1000; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #1A1625; border: 1px solid rgba(255,255,255,0.1); width: 100%; max-width: 650px; border-radius: 28px; padding: 40px; position: relative; animation: slideUp 0.3s ease-out; }
        
        #mobileMenu { transition: 0.4s ease-in-out; transform: translateX(100%); }
        #mobileMenu.open { transform: translateX(0); }
        .status-pulse { animation: statusPulse 2s infinite; }
        @keyframes statusPulse { 0%, 100% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } }
        .voice-wave { display: inline-flex; align-items: center; height: 20px; gap: 2px; }
        .voice-bar { width: 3px; background-color: #F472B6; animation: sound 0ms -800ms linear infinite alternate; }
        @keyframes sound { 0% { height: 3px; opacity: .35; } 100% { height: 15px; opacity: 1; } }
        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%); background-size: 200% 100%; animation: loading 1.5s infinite; }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body class="relative text-center">

    <div id="toast">Message</div>

    <!-- å¯¼èˆªæ  -->
    <nav class="fixed w-full z-50 bg-[#1A1625]/80 backdrop-blur-md border-b border-white/5">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="javascript:void(0)" onclick="navigateTo('home')" class="flex items-center gap-2 group">
                <i class="fa-solid fa-moon text-pink-400 text-2xl animate-pulse group-hover:rotate-12 transition-transform"></i>
                <span class="text-2xl font-serif font-bold text-white tracking-tight">DreamWhispeAi</span>
            </a>
            
            <div class="hidden md:flex items-center gap-10 text-sm font-semibold text-gray-200">
                <a href="javascript:void(0)" onclick="navigateTo('plaza')" class="hover:text-pink-300 transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-users-rays text-xs"></i> <span data-i18n="nav_square">è§£æ¢¦å¹¿åœº</span>
                </a>
                <a href="javascript:void(0)" onclick="navigateTo('dictionary')" class="hover:text-pink-300 transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-book-journal-whills text-xs"></i> <span data-i18n="nav_dict">è±¡å¾å­—å…¸</span>
                </a>
                <button onclick="openModal('about')" class="hover:text-pink-300 transition-colors" data-i18n="nav_about">å…³äºæˆ‘ä»¬</button>
                
                <div class="relative group cursor-pointer">
                    <button class="flex items-center gap-2 px-4 py-1.5 rounded-full border border-white/10 hover:bg-white/5 transition-all">
                        <i class="fa-solid fa-globe text-pink-300"></i>
                        <span id="currentLangLabel">ä¸­æ–‡</span>
                        <i class="fa-solid fa-chevron-down text-[10px] opacity-70"></i>
                    </button>
                    <!-- æ¢å¤å®Œæ•´çš„å¤šè¯­è¨€ä¸‹æ‹‰èœå• -->
                    <div class="absolute right-0 pt-2 hidden group-hover:block w-40">
                        <div class="glass-panel rounded-2xl overflow-hidden bg-[#1A1625] shadow-2xl py-2 border border-white/10">
                            <button onclick="changeLanguage('zh')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">ç®€ä½“ä¸­æ–‡</button>
                            <button onclick="changeLanguage('zh-TW')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">ç¹é«”ä¸­æ–‡</button>
                            <button onclick="changeLanguage('en')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">English</button>
                            <button onclick="changeLanguage('ru')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
                            <button onclick="changeLanguage('es')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">EspaÃ±ol</button>
                            <button onclick="changeLanguage('hi')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">à¤¹à¤¿à¤¨à¥à¤¦à¥€</button>
                            <button onclick="changeLanguage('pl')" class="block w-full text-left px-4 py-2 hover:bg-pink-500/20 text-xs">Polski</button>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="toggleMobileMenu(true)" class="md:hidden text-2xl text-white p-2">
                <i class="fa-solid fa-bars-staggered"></i>
            </button>
        </div>
    </nav>

    <!-- ç§»åŠ¨ç«¯ä¾§è¾¹æ  -->
    <div id="mobileMenu" class="fixed inset-y-0 right-0 w-80 bg-[#1A1625] z-[100] md:hidden border-l border-white/10 flex flex-col p-10 shadow-3xl">
        <button onclick="toggleMobileMenu(false)" class="self-end text-3xl text-gray-400 mb-12"><i class="fa-solid fa-xmark"></i></button>
        <div class="flex flex-col gap-8 text-xl font-medium text-left">
            <a href="javascript:void(0)" onclick="navigateTo('home'); toggleMobileMenu(false);" class="flex items-center gap-4 text-white"><i class="fa-solid fa-house text-pink-400"></i><span data-i18n="nav_home">é¦–é¡µ</span></a>
            <a href="javascript:void(0)" onclick="navigateTo('plaza'); toggleMobileMenu(false);" class="flex items-center gap-4 text-white"><i class="fa-solid fa-users-rays text-pink-400"></i><span data-i18n="nav_square">è§£æ¢¦å¹¿åœº</span></a>
            <a href="javascript:void(0)" onclick="navigateTo('dictionary'); toggleMobileMenu(false);" class="flex items-center gap-4 text-white"><i class="fa-solid fa-book-journal-whills text-pink-400"></i><span data-i18n="nav_dict">è±¡å¾å­—å…¸</span></a>
            <button onclick="openModal('about'); toggleMobileMenu(false);" class="flex items-center gap-4 text-white text-left"><i class="fa-solid fa-circle-info text-pink-400"></i><span data-i18n="nav_about">å…³äºæˆ‘ä»¬</span></button>
            <div class="mt-12 border-t border-white/5 pt-10">
                <p class="text-xs text-gray-500 uppercase tracking-widest mb-6">Language / è¯­è¨€</p>
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="changeLanguage('zh')" class="py-3 bg-white/5 rounded-xl text-sm">ä¸­æ–‡</button>
                    <button onclick="changeLanguage('en')" class="py-3 bg-white/5 rounded-xl text-sm">EN</button>
                    <button onclick="changeLanguage('es')" class="py-3 bg-white/5 rounded-xl text-sm">ES</button>
                    <button onclick="changeLanguage('ru')" class="py-3 bg-white/5 rounded-xl text-sm">RU</button>
                    <button onclick="changeLanguage('hi')" class="py-3 bg-white/5 rounded-xl text-sm">HI</button>
                    <button onclick="changeLanguage('pl')" class="py-3 bg-white/5 rounded-xl text-sm">PL</button>
                </div>
            </div>
        </div>
    </div>
    <div id="menuOverlay" onclick="toggleMobileMenu(false)" class="fixed inset-0 bg-black/70 backdrop-blur-md z-[90] hidden"></div>

    <main class="container mx-auto px-4 pt-32 pb-24 flex flex-col items-center">
        
        <!-- é¦–é¡µæ¨¡å— -->
        <div id="page-home" class="page-section active flex flex-col items-center w-full">
            <div class="text-center max-w-4xl mx-auto mb-16 animate-fade-in px-4">
                <div class="inline-block px-5 py-1.5 rounded-full glass-panel mb-8 text-pink-200 text-xs font-bold tracking-[0.2em] border-pink-500/20" data-i18n="hero_badge">AI é©±åŠ¨çš„å¿ƒç†ç–—æ„ˆ</div>
                <h1 class="text-5xl md:text-7xl font-serif font-bold mb-8 leading-[1.1] tracking-tight">
                    <span data-i18n="hero_title_1">æ¢ç´¢ä½ æ½œæ„è¯†çš„</span><br/>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-300 via-purple-300 to-indigo-300" data-i18n="hero_title_2">ç§˜å¯†èŠ±å›­</span>
                </h1>
                <p class="text-xl text-gray-300 font-light max-w-2xl mx-auto" data-i18n="hero_desc">æ¯ä¸€ä¸ªæ¢¦éƒ½æ˜¯çµé­‚å¯„æ¥çš„ä¿¡ç¬ºã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨æ¸©æŸ”çš„ç§‘æŠ€ï¼Œä¸ºæ‚¨è§£è¯»æ¢¦å¢ƒèƒŒåçš„æƒ…ç»ªä¸éšå–»ã€‚</p>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="w-full max-w-4xl glass-panel rounded-[2rem] p-6 md:p-10 shadow-3xl animate-float">
                
                <!-- ã€é‡è¦ã€‘æ¢å¤äº†è¢«è¯¯åˆ çš„è¯­éŸ³/æ–‡å­—åˆ‡æ¢æ ‡ç­¾ -->
                <div class="flex gap-6 mb-6 border-b border-white/10 pb-4">
                    <button onclick="switchInputMode('text')" id="tab-text" class="text-pink-300 font-semibold border-b-2 border-pink-300 pb-4 -mb-4.5 px-2 transition-colors">
                        <i class="fa-solid fa-pen-nib mr-2"></i><span data-i18n="tab_write">è®°å½•æ¢¦å¢ƒ</span>
                    </button>
                    <button onclick="switchInputMode('voice')" id="tab-voice" class="text-gray-400 hover:text-white transition-colors px-2 pb-4 -mb-4.5">
                        <i class="fa-solid fa-microphone mr-2"></i><span data-i18n="tab_voice">è¯­éŸ³è¿°è¯´</span>
                    </button>
                </div>

                <div class="relative group text-left">
                    <textarea id="dreamInput" class="w-full h-56 md:h-64 glass-input rounded-2xl p-8 text-xl text-white placeholder-gray-400 resize-none mb-8 leading-relaxed" data-i18n-placeholder="placeholder_text" placeholder="æ˜¨æ™šï¼Œæˆ‘æ¢¦è§..."></textarea>
                    
                    <div id="voiceIndicator" class="hidden absolute inset-0 glass-input rounded-2xl flex-col items-center justify-center bg-black/40 backdrop-blur-md z-10 flex">
                        <div class="text-pink-300 text-xl mb-4 font-semibold" data-i18n="voice_listening">æ­£åœ¨è†å¬...</div>
                        <div class="voice-wave">
                            <div class="voice-bar" style="animation-duration: 474ms"></div>
                            <div class="voice-bar" style="animation-duration: 433ms"></div>
                            <div class="voice-bar" style="animation-duration: 407ms"></div>
                            <div class="voice-bar" style="animation-duration: 458ms"></div>
                            <div class="voice-bar" style="animation-duration: 400ms"></div>
                            <div class="voice-bar" style="animation-duration: 427ms"></div>
                        </div>
                        <button onclick="stopVoiceRecognition()" class="mt-6 px-6 py-2 bg-red-500/80 hover:bg-red-500 text-white rounded-full text-sm transition" data-i18n="voice_stop">åœæ­¢å½•éŸ³</button>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-center gap-8">
                    <div class="flex items-center gap-4">
                        <p class="text-sm text-gray-400 flex items-center gap-2"><i class="fa-regular fa-eye-slash"></i> <span data-i18n="privacy_note">æ‚¨çš„æ¢¦å¢ƒå°†å®Œå…¨åŒ¿åå¤„ç†</span></p>
                        <div id="apiStatusBadge" class="flex items-center gap-2.5 px-3 py-1.5 bg-black/30 rounded-full border border-white/10 group cursor-help" title="API Status">
                            <div id="apiStatusDot" class="w-2.5 h-2.5 rounded-full status-pulse bg-blue-500 shadow-[0_0_12px_rgba(59,130,246,0.6)]"></div>
                            <span id="apiStatusText" class="hidden">Default</span>
                        </div>
                    </div>
                    <!-- ä½¿ç”¨äº†ä¿®å¤åçš„æ ·å¼ï¼ŒåŒæ—¶ä¿ç•™äº†çœŸå®çš„ API è°ƒç”¨åŠŸèƒ½ -->
                    <button onclick="callGeminiAPI()" id="analyzeBtn" class="btn-gradient w-full md:w-auto px-16 py-5 rounded-full font-black text-lg text-white shadow-2xl flex items-center justify-center gap-4 active:scale-95 transition-all">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> <span data-i18n="btn_analyze">å¼€å§‹è§£æ</span>
                    </button>
                </div>
            </div>

            <!-- ç»“æœ -->
            <div id="resultSection" class="hidden w-full max-w-4xl mt-16 animate-slide-up px-2">
                <div class="glass-panel rounded-[2rem] p-10 md:p-14 border-t-4 border-pink-400 relative overflow-hidden text-left">
                    <h3 class="text-3xl font-serif text-pink-100 mb-10 border-b border-white/5 pb-6" data-i18n="result_title">æ¢¦å¢ƒå›å“</h3>
                    <div class="space-y-10">
                        <div class="bg-black/20 rounded-[1.5rem] p-8">
                            <h4 class="text-purple-200 font-bold mb-4 flex items-center gap-3 text-lg"><i class="fa-regular fa-lightbulb"></i> <span data-i18n="label_core">æ ¸å¿ƒéšå–»</span></h4>
                            <p id="resCore" class="text-gray-200 leading-relaxed text-lg font-light"></p>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-black/20 rounded-[1.5rem] p-8">
                                <h4 class="text-pink-200 font-bold mb-4 flex items-center gap-3 text-lg"><i class="fa-regular fa-heart"></i> <span data-i18n="label_emotion">æƒ…ç»ªæ˜ å°„</span></h4>
                                <p id="resEmotion" class="text-gray-300 leading-relaxed font-light"></p>
                            </div>
                            <div class="bg-black/20 rounded-[1.5rem] p-8">
                                <h4 class="text-yellow-200 font-bold mb-4 flex items-center gap-3 text-lg"><i class="fa-regular fa-compass"></i> <span data-i18n="label_guide">ç”Ÿæ´»æŒ‡å¼•</span></h4>
                                <p id="resGuide" class="text-gray-300 leading-relaxed font-light"></p>
                            </div>
                        </div>
                        <div class="bg-white/5 rounded-2xl p-6 flex items-center gap-6 border border-white/10">
                            <div class="w-14 h-14 rounded-full bg-pink-500/20 flex items-center justify-center text-pink-300 flex-shrink-0"><i class="fa-solid fa-gem text-xl"></i></div>
                            <div>
                                <div class="text-xs text-gray-500 uppercase tracking-widest mb-1" data-i18n="label_lucky">å»ºè®®å¹¸è¿ç‰©</div>
                                <div id="resLucky" class="text-white font-bold text-lg"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è§£æ¢¦å¹¿åœºæ¨¡å— -->
        <div id="page-plaza" class="page-section px-4 w-full">
            <div class="text-center max-w-2xl mx-auto mb-16">
                <h2 class="text-4xl font-serif font-bold mb-4 text-white" data-i18n="plaza_title">è§£æ¢¦å¹¿åœº</h2>
                <p class="text-gray-400" data-i18n="plaza_desc">åœ¨è¿™é‡Œï¼Œæ¢¦å¢ƒä¸å†æ˜¯ä¸ªäººçš„å­¤å²›ã€‚å…±é¸£ï¼Œæ˜¯æ²»æ„ˆçš„å¼€å§‹ã€‚</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="glass-card p-8 rounded-3xl h-full flex flex-col cursor-pointer hover:scale-[1.02] active:scale-[0.98] transition-all text-left" onclick="fillDreamFromCard(this)">
                    <div class="flex gap-2 mb-6 text-left">
                        <span class="text-[10px] font-bold px-3 py-1 rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/20" data-i18n="card_1_tag_1">#è¿½é€</span>
                        <span class="text-[10px] font-bold px-3 py-1 rounded-full bg-blue-500/20 text-blue-300 border border-blue-500/20" data-i18n="card_1_tag_2">#ç„¦è™‘</span>
                    </div>
                    <h3 class="text-xl font-bold text-pink-50 mb-4 text-left" data-i18n="card_1_title">æ€»æ˜¯æ¢¦è§åœ¨æ—§å­¦æ ¡é‡Œæ‰¾ä¸åˆ°æ•™å®¤</h3>
                    <p class="text-gray-400 text-sm leading-relaxed mb-8 flex-grow text-left" data-i18n="card_1_desc">èµ°å»Šå˜å¾—æ— é™é•¿ï¼Œæ‰€æœ‰çš„é—¨éƒ½æ‰“ä¸å¼€ï¼Œæ„Ÿè§‰æœ‰ä¸€ç§æ— æ³•é€ƒè„±çš„å‹è¿«æ„Ÿã€‚</p>
                    <div class="mt-auto pt-6 border-t border-white/5 flex justify-between items-center text-xs text-gray-500">
                        <span><i class="fa-solid fa-robot mr-1 text-pink-400"></i> <span data-i18n="label_ai_analyzed">AI å·²è§£æ</span></span>
                        <div class="flex gap-4"><i class="fa-regular fa-heart"></i> <i class="fa-regular fa-comment"></i></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å­—å…¸æ¨¡å— -->
        <div id="page-dictionary" class="page-section px-4 w-full">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-4xl font-serif font-bold mb-8 text-white" data-i18n="dict_title">è±¡å¾å­—å…¸</h2>
                <p class="text-gray-400 mb-8" data-i18n="dict_desc">ä¸‡ç‰©çš†æœ‰éšå–»ã€‚</p>
                <div class="relative max-w-xl mx-auto mb-12">
                    <input type="text" id="dictSearch" oninput="searchDict()" onkeydown="if(event.key==='Enter') triggerSearch()" class="w-full glass-input h-16 rounded-full px-16 text-xl text-center shadow-2xl" data-i18n-placeholder="dict_search_placeholder" placeholder="æœç´¢æ„è±¡...">
                    <i class="fa-solid fa-magnifying-glass absolute left-6 top-1/2 -translate-y-1/2 text-pink-300 text-xl cursor-pointer hover:scale-110 transition-transform" onclick="triggerSearch()"></i>
                </div>
                <div class="flex flex-wrap justify-center gap-8 mb-16">
                    <div class="cursor-pointer group text-center" onclick="setSearch(translations[currentLang].cat_animals)">
                        <div class="w-16 h-16 rounded-2xl glass-panel group-hover:bg-pink-500/20 flex items-center justify-center mb-3 transition-all border border-white/10"><i class="fa-solid fa-cat text-2xl text-pink-300"></i></div>
                        <span class="text-sm text-gray-400 group-hover:text-white transition-colors" data-i18n="cat_animals">åŠ¨ç‰©</span>
                    </div>
                    <div class="cursor-pointer group text-center" onclick="setSearch(translations[currentLang].cat_nature)">
                        <div class="w-16 h-16 rounded-2xl glass-panel group-hover:bg-blue-500/20 flex items-center justify-center mb-3 transition-all border border-white/10"><i class="fa-solid fa-cloud-showers-heavy text-2xl text-blue-300"></i></div>
                        <span class="text-sm text-gray-400 group-hover:text-white transition-colors" data-i18n="cat_nature">è‡ªç„¶</span>
                    </div>
                    <div class="cursor-pointer group text-center" onclick="setSearch(translations[currentLang].cat_behavior)">
                        <div class="w-16 h-16 rounded-2xl glass-panel group-hover:bg-purple-500/20 flex items-center justify-center mb-3 transition-all border border-white/10"><i class="fa-solid fa-person-falling text-2xl text-purple-300"></i></div>
                        <span class="text-sm text-gray-400 group-hover:text-white transition-colors" data-i18n="cat_behavior">è¡Œä¸º</span>
                    </div>
                </div>
            </div>
            <div id="dictGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="glass-card dict-card p-8 rounded-3xl border-t-4 border-green-500/40 text-left" data-keywords="è›‡ snake animal åŠ¨ç‰© çˆ¬è¡Œ">
                    <div class="flex justify-between items-start mb-6">
                        <h3 class="text-2xl font-serif font-bold text-white" data-i18n="sym_snake_title">è›‡ (Snake)</h3>
                        <i class="fa-solid fa-staff-snake text-3xl text-green-400/30"></i>
                    </div>
                    <p class="text-[10px] text-gray-500 mb-3 font-black uppercase tracking-widest" data-i18n="label_psych">å¿ƒç†å­¦è§†è§’</p>
                    <p class="text-gray-300 text-sm leading-relaxed" data-i18n="sym_snake_psych">ä»£è¡¨æ½œæ„è¯†çš„æ™ºæ…§ã€æ²»æ„ˆèƒ½åŠ›ï¼Œæˆ–è¢«å‹æŠ‘çš„åŸå§‹å†²åŠ¨ã€‚</p>
                </div>
            </div>
            <div id="aiResultContainer" class="hidden mt-8 max-w-xl mx-auto"></div>
            <div id="noSearchResult" class="hidden text-center text-gray-400 py-10"><i class="fa-solid fa-wand-magic-sparkles text-4xl mb-4 text-pink-300 animate-pulse"></i><p data-i18n="no_result_msg">æ­£åœ¨å”¤é†’ AI ä¸ºæ‚¨è§£æ...</p></div>
        </div>
    </main>

    <footer class="border-t border-white/5 bg-black/40 py-20 mt-20 text-left">
        <div class="container mx-auto px-10">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-12 text-left">
                <div class="max-w-sm">
                    <div class="flex items-center gap-2 mb-6"><i class="fa-solid fa-moon text-pink-400 text-xl"></i><span class="text-xl font-serif font-bold text-white">DreamWhispeAi</span></div>
                    <div class="flex gap-6">
                        <button onclick="openModal('terms')" class="hover:text-pink-300 underline text-xs text-gray-400 transition-colors" data-i18n="footer_terms">æœåŠ¡æ¡æ¬¾</button>
                        <button onclick="openModal('privacy')" class="hover:text-pink-300 underline text-xs text-gray-400 transition-colors" data-i18n="footer_privacy">éšç§æ”¿ç­–</button>
                        <button onclick="openModal('contact')" class="hover:text-pink-300 underline text-xs text-gray-400 transition-colors" data-i18n="footer_contact">è”ç³»æˆ‘ä»¬</button>
                    </div>
                </div>
                <div class="flex flex-col items-center md:items-end gap-4">
                    <p class="text-gray-600 text-[10px] tracking-widest uppercase">&copy; 2024 <span data-i18n="footer_copyright">dreamwhisperai</span></p>
                    <div class="text-[10px] text-gray-800 select-none cursor-default font-mono transition-colors hover:text-gray-600" ondblclick="openModal('settings')">
                        BUILD ID: <span data-i18n="footer_build">DW-20241219-GOLD (Click to Debug)</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- é€šç”¨æ¨¡æ€æ¡† -->
    <div id="modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content">
            <button onclick="closeModal(null)" class="absolute top-8 right-8 text-gray-500 text-3xl hover:text-white transition-colors">&times;</button>
            <h2 id="modalTitle" class="text-3xl font-serif text-pink-200 mb-8 flex items-center gap-3 text-left">Title</h2>
            <div id="modalBody" class="text-gray-300 leading-relaxed text-base max-h-[60vh] overflow-y-auto pr-4 text-left"></div>
        </div>
    </div>

    <!-- API è®¾ç½® -->
    <div id="settingsModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content bg-[#1A1625]">
            <h2 class="text-2xl font-serif text-pink-200 mb-6 flex items-center gap-3"><i class="fa-solid fa-sliders"></i> API Configuration</h2>
            <div class="space-y-6">
                <input type="password" id="apiKeyInput" class="w-full glass-input rounded-xl p-4 text-white font-mono text-sm text-left" placeholder="AIzaSy... (Google Gemini Key)">
                <div class="flex gap-4 text-center">
                    <button onclick="saveApiKey()" class="flex-grow py-4 btn-gradient rounded-xl font-black shadow-xl">ä¿å­˜é…ç½®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Key åœ¨ Canvas é¢„è§ˆç¯å¢ƒä¸­åº”è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œç¯å¢ƒä¼šè‡ªåŠ¨æä¾›ã€‚
        const DEFAULT_API_KEY = "";
        
        // ã€é‡è¦ã€‘å®Œå…¨ä¿ç•™äº†æ—§ç‰ˆæ‰€æœ‰çš„å¤šè¯­è¨€æ”¯æŒï¼Œæ²¡æœ‰åˆ å‡
        const translations = {
            'zh': {
                nav_home: "é¦–é¡µ", nav_square: "è§£æ¢¦å¹¿åœº", nav_dict: "è±¡å¾å­—å…¸", nav_about: "å…³äºæˆ‘ä»¬",
                hero_badge: "AI é©±åŠ¨çš„å¿ƒç†ç–—æ„ˆ", hero_title_1: "æ¢ç´¢ä½ æ½œæ„è¯†çš„", hero_title_2: "ç§˜å¯†èŠ±å›­",
                hero_desc: "æ¯ä¸€ä¸ªæ¢¦éƒ½æ˜¯çµé­‚å¯„æ¥çš„ä¿¡ç¬ºã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨æ¸©æŸ”çš„ç§‘æŠ€ï¼Œä¸ºæ‚¨è§£è¯»æ¢¦å¢ƒèƒŒåçš„æƒ…ç»ªä¸éšå–»ï¼Œæ‰¾å›å†…å¿ƒçš„å¹³é™ã€‚",
                tab_write: "è®°å½•æ¢¦å¢ƒ", tab_voice: "è¯­éŸ³è¿°è¯´", voice_listening: "æ­£åœ¨è†å¬...", voice_stop: "åœæ­¢å½•éŸ³",
                placeholder_text: "æ˜¨æ™šï¼Œæˆ‘æ¢¦è§...", privacy_note: "æ‚¨çš„æ¢¦å¢ƒå°†å®Œå…¨åŒ¿åå¤„ç†", btn_analyze: "å¼€å§‹è§£æ",
                result_title: "æ¢¦å¢ƒå›å“", label_core: "æ ¸å¿ƒéšå–»", label_emotion: "æƒ…ç»ªæ˜ å°„", label_guide: "ç”Ÿæ´»æŒ‡å¼•", label_lucky: "å»ºè®®å¹¸è¿ç‰©",
                status_ready: "å°±ç»ª", status_default: "é»˜è®¤", status_local: "æœ¬åœ°æ¨¡å¼", status_proxy: "ä»£ç†æ¨¡å¼",
                plaza_title: "è§£æ¢¦å¹¿åœº", plaza_desc: "åœ¨è¿™é‡Œï¼Œæ¢¦å¢ƒä¸å†æ˜¯ä¸ªäººçš„å­¤å²›ã€‚å…±é¸£ï¼Œæ˜¯æ²»æ„ˆçš„å¼€å§‹ã€‚",
                card_1_tag_1: "#è¿½é€", card_1_tag_2: "#ç„¦è™‘", label_ai_analyzed: "AI å·²è§£æ",
                card_1_title: "æ€»æ˜¯æ¢¦è§åœ¨æ—§å­¦æ ¡é‡Œæ‰¾ä¸åˆ°æ•™å®¤", card_1_desc: "æ¢¦é‡Œæˆ‘å¾ˆç€æ€¥ï¼Œä¸Šè¯¾é“ƒå“äº†ï¼Œä½†æˆ‘æ€ä¹ˆä¹Ÿæ‰¾ä¸åˆ°é«˜ä¸‰çš„æ•™å®¤ã€‚",
                dict_title: "è±¡å¾å­—å…¸", dict_desc: "ä¸‡ç‰©çš†æœ‰éšå–»ã€‚åœ¨è¿™é‡ŒæŸ¥é˜…æ¢¦ä¸­æ„è±¡çš„å¿ƒç†å­¦ä¸ä¼ ç»Ÿæ–‡åŒ–è§£è¯»ã€‚",
                dict_search_placeholder: "æœç´¢æ„è±¡ï¼ˆå¦‚ï¼šè›‡ã€è€ƒè¯•ã€ä¸‹é›¨...ï¼‰",
                cat_animals: "åŠ¨ç‰©", cat_nature: "è‡ªç„¶", cat_behavior: "è¡Œä¸º",
                sym_snake_title: "è›‡ (Snake)", label_psych: "å¿ƒç†å­¦è§†è§’", sym_snake_psych: "ä»£è¡¨æ½œæ„è¯†çš„æ™ºæ…§ã€æ²»æ„ˆèƒ½åŠ›ï¼Œæˆ–è¢«å‹æŠ‘çš„åŸå§‹å†²åŠ¨ã€‚",
                footer_terms: "æœåŠ¡æ¡æ¬¾", footer_privacy: "éšç§æ”¿ç­–", footer_contact: "è”ç³»æˆ‘ä»¬", footer_copyright: "dreamwhisperai", footer_build: "DW-20241219-GOLD (ç‚¹å‡»è°ƒè¯•)",
                modal_about_title: "å…³äº dreamwhisperai",
                modal_about_body: "dreamwhisperai æ˜¯ä¸€æ¬¾ä¸“æ³¨äºæ¢¦å¢ƒå¿ƒç†å­¦åˆ†æçš„ AI å¹³å°ã€‚æˆ‘ä»¬ç›¸ä¿¡æ¢¦å¢ƒæ˜¯æ½œæ„è¯†ä¸æ„è¯†ä¹‹é—´çš„æ¡¥æ¢ã€‚",
                modal_terms_title: "æœåŠ¡æ¡æ¬¾",
                modal_terms_body: "<strong>1. æ¥å—æ¡æ¬¾</strong><br>è®¿é—®å’Œä½¿ç”¨ https://dreamwhisperai.comï¼Œå³è¡¨ç¤ºæ‚¨æ¥å—å¹¶åŒæ„å—æœ¬åè®®æ¡æ¬¾å’Œæ¡ä»¶çš„çº¦æŸã€‚<br><br><strong>2. æœåŠ¡è¯´æ˜</strong><br>æœ¬æœåŠ¡ä»…ä¾›å¨±ä¹å’Œè‡ªæˆ‘æ¢ç´¢ä¹‹ç”¨ï¼Œä¸æ„æˆä¸“ä¸šçš„å¿ƒç†å’¨è¯¢æˆ–åŒ»ç–—å»ºè®®ã€‚",
                modal_privacy_title: "éšç§æ”¿ç­–",
                modal_privacy_body: "æˆ‘ä»¬éå¸¸é‡è§†æ‚¨çš„éšç§ã€‚<br><br>1. æ‚¨çš„æ¢¦å¢ƒè¾“å…¥å†…å®¹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ç»è¿‡ SSL åŠ å¯†ã€‚<br>2. æˆ‘ä»¬ä¸ä¼šå°†æ‚¨çš„ä¸ªäººèº«ä»½ä¿¡æ¯å‡ºå”®ç»™ç¬¬ä¸‰æ–¹ã€‚",
                modal_contact_title: "è”ç³»æˆ‘ä»¬",
                modal_contact_body: "å¦‚æœæœ‰ä»»ä½•å»ºè®®ã€åé¦ˆæˆ–åˆä½œæ„å‘ï¼Œæ¬¢è¿éšæ—¶å‘é€é‚®ä»¶ç»™æˆ‘ä»¬ï¼š<br><br><span class='text-pink-300 font-bold'>n20186005@gmail.com</span><br><br>We typically respond within 24 hours.",
                toast_analyzing: "æ­£åœ¨å”¤é†’ AI å¯¼å¸ˆ...", toast_done: "è§£æå·²å‘ˆä¸Š", no_result_msg: "æ­£åœ¨å”¤é†’ AI ä¸ºæ‚¨è§£æ..."
            },
            'zh-TW': {
                nav_home: "é¦–é ", nav_square: "è§£å¤¢å»£å ´", nav_dict: "è±¡å¾µå­—å…¸", nav_about: "é—œæ–¼æˆ‘å€‘",
                hero_badge: "AI é©…å‹•çš„å¿ƒç†ç™‚æ„ˆ", hero_title_1: "æ¢ç´¢ä½ æ½›æ„è­˜çš„", hero_title_2: "ç§˜å¯†èŠ±åœ’",
                hero_desc: "æ¯ä¸€å€‹å¤¢éƒ½æ˜¯éˆé­‚å¯„ä¾†çš„ä¿¡ç®‹ã€‚åœ¨é€™è£¡ï¼Œæˆ‘å€‘ç”¨æº«æŸ”çš„ç§‘æŠ€ï¼Œç‚ºæ‚¨è§£è®€å¤¢å¢ƒèƒŒå¾Œçš„æƒ…ç·’èˆ‡éš±å–»ï¼Œæ‰¾å›å…§å¿ƒçš„å¹³éœã€‚",
                tab_write: "è¨˜éŒ„å¤¢å¢ƒ", tab_voice: "èªéŸ³è¿°èªª", voice_listening: "æ­£åœ¨è†è½...", voice_stop: "åœæ­¢éŒ„éŸ³",
                placeholder_text: "æ˜¨æ™šï¼Œæˆ‘å¤¢è¦‹...", privacy_note: "æ‚¨çš„å¤¢å¢ƒå°‡å®Œå…¨åŒ¿åè™•ç†", btn_analyze: "é–‹å§‹è§£æ",
                result_title: "å¤¢å¢ƒå›éŸ¿", label_core: "æ ¸å¿ƒéš±å–»", label_emotion: "æƒ…ç·’æ˜ å°„", label_guide: "ç”Ÿæ´»æŒ‡å¼•", label_lucky: "å»ºè­°å¹¸é‹ç‰©",
                status_ready: "å°±ç·’", status_default: "é»˜èª", status_local: "æœ¬åœ°æ¨¡å¼", status_proxy: "ä»£ç†æ¨¡å¼",
                plaza_title: "è§£å¤¢å»£å ´", plaza_desc: "åœ¨é€™è£¡ï¼Œå¤¢å¢ƒä¸å†æ˜¯å€‹äººçš„å­¤å³¶ã€‚å…±é³´ï¼Œæ˜¯æ²»æ„ˆçš„é–‹å§‹ã€‚",
                card_1_tag_1: "#è¿½é€", card_1_tag_2: "#ç„¦æ…®", label_ai_analyzed: "AI å·²è§£æ",
                card_1_title: "ç¸½æ˜¯å¤¢è¦‹åœ¨èˆŠå­¸æ ¡è£¡æ‰¾ä¸åˆ°æ•™å®¤", card_1_desc: "å¤¢è£¡æˆ‘å¾ˆè‘—æ€¥ï¼Œä¸Šèª²éˆ´éŸ¿äº†ã€‚",
                dict_title: "è±¡å¾µå­—å…¸", dict_desc: "è¬ç‰©çš†æœ‰éš±å–»ã€‚",
                dict_search_placeholder: "æœç´¢æ„è±¡...",
                cat_animals: "å‹•ç‰©", cat_nature: "è‡ªç„¶", cat_behavior: "è¡Œç‚º",
                sym_snake_title: "è›‡ (Snake)", label_psych: "å¿ƒç†å­¸è¦–è§’", sym_snake_psych: "ä»£è¡¨æ½›æ„è­˜çš„æ™ºæ…§ã€æ²»æ„ˆèƒ½åŠ›ã€‚",
                footer_terms: "æœå‹™æ¢æ¬¾", footer_privacy: "éš±ç§æ”¿ç­–", footer_contact: "è¯ç¹«æˆ‘å€‘", footer_copyright: "dreamwhisperai", footer_build: "DW-20241219-GOLD (é»æ“Šèª¿è©¦)",
                modal_about_title: "é—œæ–¼ dreamwhisperai", modal_about_body: "dreamwhisperai æ˜¯ä¸€æ¬¾å°ˆæ³¨æ–¼å¤¢å¢ƒå¿ƒç†å­¸åˆ†æçš„ AI å¹³å°ã€‚æˆ‘å€‘ç›¸ä¿¡å¤¢å¢ƒæ˜¯æ½›æ„è­˜èˆ‡æ„è­˜ä¹‹é–“çš„æ©‹æ¢ã€‚",
                modal_terms_title: "æœå‹™æ¢æ¬¾", modal_terms_body: "<strong>1. æ¥å—æ¢æ¬¾</strong><br>è¨ªå•å’Œä½¿ç”¨ https://dreamwhisperai.comï¼Œå³è¡¨ç¤ºæ‚¨æ¥å—ä¸¦åŒæ„å—æœ¬å”è­°æ¢æ¬¾å’Œæ¢ä»¶çš„ç´„æŸã€‚<br><br><strong>2. æœå‹™èªªæ˜</strong><br>æœ¬æœå‹™åƒ…ä¾›å¨›æ¨‚å’Œè‡ªæˆ‘æ¢ç´¢ä¹‹ç”¨ï¼Œä¸æ§‹æˆå°ˆæ¥­çš„å¿ƒç†è«®è©¢æˆ–é†«ç™‚å»ºè­°ã€‚",
                modal_privacy_title: "éš±ç§æ”¿ç­–", modal_privacy_body: "æˆ‘å€‘éå¸¸é‡è¦–æ‚¨çš„éš±ç§ã€‚<br><br>1. æ‚¨çš„å¤¢å¢ƒè¼¸å…¥å…§å®¹åœ¨å‚³è¼¸éç¨‹ä¸­ç¶“é SSL åŠ å¯†ã€‚<br>2. æˆ‘å€‘ä¸æœƒå°‡æ‚¨çš„å€‹äººèº«ä»½ä¿¡æ¯å‡ºå”®çµ¦ç¬¬ä¸‰æ–¹ã€‚",
                modal_contact_title: "è¯ç¹«æˆ‘å€‘", modal_contact_body: "åˆä½œéƒµä»¶ï¼š<span class='text-pink-300 font-bold'>n20186005@gmail.com</span>",
                toast_analyzing: "æ­£åœ¨å–šé†’ AI å°å¸«...", toast_done: "è§£æå·²å‘ˆä¸Š"
            },
            'en': {
                nav_home: "Home", nav_square: "Plaza", nav_dict: "Dict", nav_about: "About Us",
                hero_badge: "AI-Powered Healing", hero_title_1: "Explore Your", hero_title_2: "Secret Garden",
                hero_desc: "Every dream is a letter from your soul.",
                tab_write: "Write", tab_voice: "Speak", voice_listening: "Listening...", voice_stop: "Stop",
                placeholder_text: "Last night...", privacy_note: "Processed anonymously", btn_analyze: "Analyze",
                result_title: "Dream Echo", label_core: "Metaphor", label_emotion: "Emotions", label_guide: "Guidance", label_lucky: "Lucky Item",
                status_ready: "Ready", status_default: "Default", status_local: "Local", status_proxy: "Proxy",
                plaza_title: "Plaza", plaza_desc: "Dreams are no longer isolated islands.",
                card_1_tag_1: "#Chase", card_1_tag_2: "#Anxiety", label_ai_analyzed: "AI Analyzed",
                card_1_title: "Lost in Old School", card_1_desc: "I was in a rush but couldn't find the classroom.",
                dict_title: "Dictionary", dict_desc: "Everything is a metaphor.",
                dict_search_placeholder: "Search symbols...",
                cat_animals: "Animals", cat_nature: "Nature", cat_behavior: "Behavior",
                footer_terms: "Terms", footer_privacy: "Privacy", footer_contact: "Contact", footer_copyright: "dreamwhisperai", footer_build: "DW-20241219-GOLD (Click to Debug)",
                modal_about_title: "About dreamwhisperai", modal_about_body: "dreamwhisperai is an AI platform for dream analysis. We believe dreams are bridges.",
                modal_terms_title: "Terms of Service", modal_terms_body: "<strong>1. Acceptance</strong><br>By using dreamwhisperai.com... <strong>2. Description</strong><br>For entertainment only.",
                modal_privacy_title: "Privacy Policy", modal_privacy_body: "We value your privacy.<br><br>1. Inputs are SSL encrypted.",
                modal_contact_title: "Contact Us", modal_contact_body: "Email: <span class='text-pink-300 font-bold'>n20186005@gmail.com</span>",
                toast_analyzing: "Awakening AI...", toast_done: "Done"
            },
            'ru': {
                nav_home: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ", nav_square: "ĞŸĞ»Ğ¾Ñ‰Ğ°Ğ´ÑŒ", nav_dict: "Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ", nav_about: "Ğ Ğ½Ğ°Ñ",
                hero_badge: "Ğ˜Ğ˜-Ğ¸ÑÑ†ĞµĞ»ĞµĞ½Ğ¸Ğµ", hero_title_1: "Ğ˜ÑÑĞ»ĞµĞ´ÑƒĞ¹", hero_title_2: "Ğ¡ĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ ÑĞ°Ğ´",
                hero_desc: "ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ¾Ğ½ â€” Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾ Ğ¾Ñ‚ Ñ‚Ğ²Ğ¾ĞµĞ¹ Ğ´ÑƒÑˆĞ¸.",
                tab_write: "ĞŸĞ¸ÑĞ°Ñ‚ÑŒ", tab_voice: "Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ÑŒ", voice_listening: "Ğ¡Ğ»ÑƒÑˆĞ°Ñ...", voice_stop: "Ğ¡Ñ‚Ğ¾Ğ¿",
                placeholder_text: "ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾Ğ¹ Ğ½Ğ¾Ñ‡ÑŒÑ...", btn_analyze: "ĞĞ½Ğ°Ğ»Ğ¸Ğ·",
                result_title: "Ğ­Ñ…Ğ¾ ÑĞ½Ğ°", label_core: "ĞœĞµÑ‚Ğ°Ñ„Ğ¾Ñ€Ğ°", label_emotion: "Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¸", label_guide: "Ğ¡Ğ¾Ğ²ĞµÑ‚", label_lucky: "Ğ¢Ğ°Ğ»Ğ¸ÑĞ¼Ğ°Ğ½",
                status_ready: "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾", status_default: "Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚", status_local: "Ğ›Ğ¾ĞºĞ°Ğ»", status_proxy: "ĞŸÑ€Ğ¾ĞºÑĞ¸",
                plaza_title: "ĞŸĞ»Ğ¾Ñ‰Ğ°Ğ´ÑŒ", plaza_desc: "Ğ¡Ğ½Ñ‹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ½Ğµ Ğ¾Ğ´Ğ¸Ğ½Ğ¾ĞºĞ¸Ğµ Ğ¾ÑÑ‚Ñ€Ğ¾Ğ²Ğ°.",
                dict_title: "Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ", cat_animals: "Ğ–Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ñ‹Ğµ", cat_nature: "ĞŸÑ€Ğ¸Ñ€Ğ¾Ğ´Ğ°", cat_behavior: "ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ğµ",
                footer_terms: "Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ", footer_privacy: "ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ", footer_contact: "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹", footer_copyright: "dreamwhisperai",
                modal_about_title: "Ğ dreamwhisperai", modal_about_body: "dreamwhisperai â€” ÑÑ‚Ğ¾ Ğ˜Ğ˜-Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° ÑĞ½Ğ¾Ğ². ĞœÑ‹ Ğ²ĞµÑ€Ğ¸Ğ¼, Ñ‡Ñ‚Ğ¾ ÑĞ½Ñ‹ â€” ÑÑ‚Ğ¾ Ğ¼Ğ¾ÑÑ‚.",
                modal_terms_title: "Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ", modal_terms_body: "<strong>1. Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¸Ğµ</strong><br>Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ ÑĞ°Ğ¹Ñ‚, Ğ²Ñ‹ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞ°ĞµÑ‚ĞµÑÑŒ Ñ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑĞ¼Ğ¸.",
                modal_privacy_title: "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ´ĞµĞ½Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ", modal_privacy_body: "ĞœÑ‹ Ñ†ĞµĞ½Ğ¸Ğ¼ Ğ²Ğ°ÑˆÑƒ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ. Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ¿Ğ¾ SSL.",
                modal_contact_title: "ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹", modal_contact_body: "Email: <span class='text-pink-300 font-bold'>n20186005@gmail.com</span>",
                toast_analyzing: "Ğ˜Ğ˜ Ğ´ÑƒĞ¼Ğ°ĞµÑ‚...", toast_done: "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾"
            },
            'es': {
                nav_home: "Inicio", nav_square: "Plaza", nav_dict: "Diccionario", nav_about: "Nosotros",
                hero_badge: "SanaciÃ³n con IA", hero_title_1: "Explora Tu", hero_title_2: "JardÃ­n Secreto",
                hero_desc: "Cada sueÃ±o es una carta de tu alma.",
                tab_write: "Escribir", tab_voice: "Hablar", voice_listening: "Escuchando...", voice_stop: "Parar",
                placeholder_text: "Anoche soÃ±Ã©...", btn_analyze: "Analizar",
                result_title: "Eco del SueÃ±o", label_core: "MetÃ¡fora", label_emotion: "Emociones", label_guide: "GuÃ­a", label_lucky: "Amuleto",
                status_ready: "Listo", status_default: "Por defecto", status_local: "Local", status_proxy: "Proxy",
                plaza_title: "Plaza", plaza_desc: "AquÃ­, los sueÃ±os ya no son islas.",
                dict_title: "Diccionario", cat_animals: "Animales", cat_nature: "Naturaleza", cat_behavior: "Comportamiento",
                footer_terms: "TÃ©rminos", footer_privacy: "Privacidad", footer_contact: "Contacto",
                modal_about_title: "Sobre dreamwhisperai", modal_about_body: "dreamwhisperai es una plataforma de AI para analizar sueÃ±os.",
                modal_terms_title: "TÃ©rminos", modal_terms_body: "<strong>1. AceptaciÃ³n</strong><br>Al usar este sitio, aceptas los tÃ©rminos.",
                modal_privacy_title: "Privacidad", modal_privacy_body: "Valoramos tu privacidad. SSL encriptado.",
                modal_contact_title: "Contacto", modal_contact_body: "Email: <span class='text-pink-300 font-bold'>n20186005@gmail.com</span>",
                toast_analyzing: "IA analizando...", toast_done: "Listo"
            },
            'hi': {
                nav_home: "à¤¹à¥‹à¤®", nav_square: "à¤ªà¥à¤²à¤¾à¤œà¤¾", nav_dict: "à¤¶à¤¬à¥à¤¦à¤•à¥‹à¤¶", nav_about: "à¤¹à¤®à¤¾à¤°à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚",
                hero_badge: "AI à¤¸à¤‚à¤šà¤¾à¤²à¤¿à¤¤ à¤¹à¥€à¤²à¤¿à¤‚à¤—", hero_title_1: "à¤…à¤ªà¤¨à¥‡ à¤…à¤µà¤šà¥‡à¤¤à¤¨ à¤•à¥‹", hero_title_2: "à¤–à¥‹à¤œà¥‡à¤‚",
                hero_desc: "à¤¹à¤° à¤¸à¤ªà¤¨à¤¾ à¤†à¤ªà¤•à¥€ à¤†à¤¤à¥à¤®à¤¾ à¤•à¤¾ à¤à¤• à¤ªà¤¤à¥à¤° à¤¹à¥ˆà¥¤",
                tab_write: "à¤²à¤¿à¤–à¥‡à¤‚", tab_voice: "à¤¬à¥‹à¤²à¥‡à¤‚", voice_listening: "à¤¸à¥à¤¨ à¤°à¤¹à¥‡ à¤¹à¥ˆà¤‚...", voice_stop: "à¤°à¥à¤•à¥‡à¤‚",
                btn_analyze: "à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤•à¤°à¥‡à¤‚", status_ready: "à¤¤à¥ˆà¤¯à¤¾à¤°", status_default: "à¤¡à¤¿à¤«à¤¼à¥‰à¤²à¥à¤Ÿ", status_local: "à¤¸à¥à¤¥à¤¾à¤¨à¥€à¤¯", status_proxy: "à¤ªà¥à¤°à¥‰à¤•à¥à¤¸à¥€",
                plaza_title: "à¤¸à¤ªà¤¨à¤¾ à¤ªà¥à¤²à¤¾à¤œà¤¾", plaza_desc: "Resonance is the beginning of healing.",
                dict_title: "à¤¶à¤¬à¥à¤¦à¤•à¥‹à¤¶", cat_animals: "à¤œà¤¾à¤¨à¤µà¤°", cat_nature: "à¤ªà¥à¤°à¤•à¥ƒà¤¤à¤¿", cat_behavior: "à¤µà¥à¤¯à¤µà¤¹à¤¾à¤°",
                footer_terms: "à¤¶à¤°à¥à¤¤à¥‡à¤‚", footer_privacy: "à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾", footer_contact: "à¤¸à¤‚à¤ªà¤°à¥à¤•",
                modal_about_title: "dreamwhisperai à¤•à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚", modal_about_body: "dreamwhisperai à¤¸à¤ªà¤¨à¥‹à¤‚ à¤•à¥‡ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤£ à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• AI à¤®à¤‚à¤š à¤¹à¥ˆà¥¤",
                modal_terms_title: "à¤¶à¤°à¥à¤¤à¥‡à¤‚", modal_terms_body: "<strong>1. à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤à¤¿</strong><br>à¤‡à¤¸ à¤¸à¤¾à¤‡à¤Ÿ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤¶à¤°à¥à¤¤à¥‹à¤‚ à¤•à¥€ à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤à¤¿ à¤¹à¥ˆà¥¤",
                modal_privacy_title: "à¤—à¥‹à¤ªà¤¨à¥€à¤¯à¤¤à¤¾", modal_privacy_body: "SSL à¤à¤¨à¥à¤•à¥à¤°à¤¿à¤ªà¥à¤¶à¤¨à¥¤",
                modal_contact_title: "à¤¸à¤‚à¤ªà¤°à¥à¤•", modal_contact_body: "à¤ˆà¤®à¥‡à¤²: <span class='text-pink-300 font-bold'>n20186005@gmail.com</span>"
            },
            'pl': {
                nav_home: "GÅ‚Ã³wna", nav_square: "Plac", nav_dict: "SÅ‚ownik", nav_about: "O nas",
                hero_badge: "Uzdrowienie przez AI", hero_title_1: "Odkryj SwÃ³j", hero_title_2: "Sekretny OgrÃ³d",
                hero_desc: "KaÅ¼dy sen to list od Twojej duszy.",
                tab_write: "Pisanie", tab_voice: "MÃ³wienie", voice_listening: "SÅ‚uchanie...", voice_stop: "Stop",
                btn_analyze: "Analizuj", status_ready: "Gotowe", status_default: "DomyÅ›lny", status_local: "Lokalny", status_proxy: "Proxy",
                plaza_title: "Plac SnÃ³w", plaza_desc: "Sny nie sÄ… juÅ¼ samotnymi wyspami.",
                dict_title: "SÅ‚ownik", cat_animals: "ZwierzÄ™ta", cat_nature: "Natura", cat_behavior: "Zachowanie",
                footer_terms: "Warunki", footer_privacy: "PrywatnoÅ›Ä‡", footer_contact: "Kontakt",
                modal_about_title: "O dreamwhisperai", modal_about_body: "dreamwhisperai to platforma AI do analizy snÃ³w.",
                modal_terms_title: "Warunki", modal_terms_body: "<strong>1. Akceptacja</strong><br>Korzystanie z witryny oznacza akceptacjÄ™.",
                modal_privacy_title: "PrywatnoÅ›Ä‡", modal_privacy_body: "Szyfrowanie SSL.",
                modal_contact_title: "Kontakt", modal_contact_body: "Email: <span class='text-pink-300 font-bold'>n20186005@gmail.com</span>"
            }
        };

        let currentLang = 'zh';

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            changeLanguage(params.get('lang') || 'zh', false);
            navigateTo(params.get('page') || 'home', false);
            updateApiStatus();
        };

        function changeLanguage(lang, updateURL = true) {
            currentLang = translations[lang] ? lang : 'zh';
            document.documentElement.lang = currentLang;
            const labels = { 'zh': 'ç®€ä½“ä¸­æ–‡', 'zh-TW': 'ç¹é«”ä¸­æ–‡', 'en': 'English', 'es': 'EspaÃ±ol', 'ru': 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', 'hi': 'à¤¹à¤¿à¤¨à¥à¤¦à¥€', 'pl': 'Polski' };
            const labelEl = document.getElementById('currentLangLabel');
            if(labelEl) labelEl.innerText = labels[currentLang] || 'Language';
            
            if (updateURL) {
                try {
                    const url = new URL(window.location.href);
                    url.searchParams.set('lang', currentLang);
                    window.history.pushState({}, '', url.toString());
                } catch (e) {}
            }

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) el.innerHTML = translations[currentLang][key];
            });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[currentLang][key]) el.placeholder = translations[currentLang][key];
            });
            updateApiStatus();
        }

        function navigateTo(pageId, updateURL = true) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(`page-${pageId}`);
            if (target) {
                target.classList.add('active');
                if (updateURL) {
                    try {
                        const url = new URL(window.location.href);
                        url.searchParams.set('page', pageId);
                        window.history.pushState({}, '', url.toString());
                    } catch (e) {}
                }
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        let recognition;
        function switchInputMode(mode) {
            const tabText = document.getElementById('tab-text');
            const tabVoice = document.getElementById('tab-voice');
            if (mode === 'voice') {
                tabVoice.className = "text-pink-300 font-semibold border-b-2 border-pink-300 pb-4 -mb-4.5 px-2 transition-colors";
                tabText.className = "text-gray-400 hover:text-white transition-colors px-2 pb-4 -mb-4.5";
                startVoiceRecognition();
            } else {
                tabText.className = "text-pink-300 font-semibold border-b-2 border-pink-300 pb-4 -mb-4.5 px-2 transition-colors";
                tabVoice.className = "text-gray-400 hover:text-white transition-colors px-2 pb-4 -mb-4.5";
                stopVoiceRecognition();
            }
        }

        function startVoiceRecognition() {
            if (!('webkitSpeechRecognition' in window)) { showToast("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥"); return; }
            recognition = new webkitSpeechRecognition();
            recognition.lang = currentLang === 'en' ? 'en-US' : 'zh-CN';
            recognition.continuous = true;
            document.getElementById('voiceIndicator').classList.remove('hidden');
            recognition.onresult = (e) => {
                document.getElementById('dreamInput').value += e.results[e.results.length - 1][0].transcript;
            };
            recognition.start();
        }

        function stopVoiceRecognition() { if (recognition) recognition.stop(); document.getElementById('voiceIndicator').classList.add('hidden'); }

        function updateApiStatus() {
            const dot = document.getElementById('apiStatusDot');
            const badge = document.getElementById('apiStatusBadge');
            const localKey = localStorage.getItem('dreamwhisper_api_key');
            const trans = translations[currentLang];
            if (localKey) {
                dot.className = "w-2.5 h-2.5 rounded-full status-pulse bg-green-500 shadow-[0_0_12px_rgba(34,197,94,0.7)]";
                badge.title = "Status: " + (trans.status_local || "Local Mode");
            } else {
                dot.className = "w-2.5 h-2.5 rounded-full status-pulse bg-blue-500 shadow-[0_0_12px_rgba(59,130,246,0.7)]";
                badge.title = "Status: " + (trans.status_default || "Default Mode");
            }
        }

        async function callGeminiAPI(customPrompt = null) {
            const input = document.getElementById('dreamInput').value.trim();
            const btn = document.getElementById('analyzeBtn');
            const localKey = localStorage.getItem('dreamwhisper_api_key');
            const activeKey = localKey || DEFAULT_API_KEY;
            const rawDreamInput = customPrompt || input;
            if (!rawDreamInput) { showToast("è¯·è¾“å…¥å†…å®¹"); return; }
            btn.disabled = true;
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Analyzing...`;
            showToast(translations[currentLang].toast_analyzing);
            try {
                const data = await callGeminiClientSide(rawDreamInput, currentLang, activeKey, !!customPrompt);
                if (customPrompt) return data;
                renderResult(data);
            } catch (error) {
                console.error(error);
                showToast("è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<i class="fa-solid fa-wand-magic-sparkles"></i> <span data-i18n="btn_analyze">${translations[currentLang].btn_analyze}</span>`;
            }
        }

        async function callGeminiClientSide(content, lang, apiKey, isRawPrompt = false) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const finalPrompt = isRawPrompt ? content : `Analyze dream: "${content}" return raw JSON: {"core_metaphor": "", "emotions": "", "guidance": "", "lucky_item": ""}. Language: ${lang}.`;
            const payload = { contents: [{ parts: [{ text: finalPrompt }] }] };
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (response.ok) {
                        const data = await response.json();
                        const resultText = data.candidates?.[0]?.content?.parts?.[0]?.text || "{}";
                        return extractJson(resultText);
                    }
                    if (response.status === 429 || (response.status >= 500 && response.status < 600)) {
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                        continue;
                    }
                    throw new Error(`API Error: ${response.status}`);
                } catch (e) {
                    if (i === 4) throw e;
                    await new Promise(r => setTimeout(r, delay));
                    delay *= 2;
                }
            }
            throw new Error("All API retries failed.");
        }

        function extractJson(text) { try { return JSON.parse(text); } catch (e) { const match = text.match(/\{[\s\S]*\}/); return match ? JSON.parse(match[0]) : {}; } }

        function renderResult(data) {
            if (!data || typeof data !== 'object') return;
            document.getElementById('resCore').innerText = data.core_metaphor || "";
            document.getElementById('resEmotion').innerText = data.emotions || "";
            document.getElementById('resGuide').innerText = data.guidance || "";
            document.getElementById('resLucky').innerText = data.lucky_item || "";
            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth' });
        }

        function showToast(msg) { const t = document.getElementById('toast'); t.innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 3000); }

        function openModal(type) {
            if (type === 'settings') { document.getElementById('settingsModal').style.display = 'flex'; return; }
            const m = document.getElementById('modal');
            const titleEl = document.getElementById('modalTitle');
            const bodyEl = document.getElementById('modalBody');
            titleEl.innerText = translations[currentLang][`modal_${type}_title`] || translations[currentLang][`nav_${type}`] || "Info";
            bodyEl.innerHTML = translations[currentLang][`modal_${type}_body`] || "Detail content is missing...";
            m.style.display = 'flex';
        }

        function closeModal(e) { if (!e || e.target.classList.contains('modal') || e.target.innerText === 'Ã—') { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); } }

        function saveApiKey() { localStorage.setItem('dreamwhisper_api_key', document.getElementById('apiKeyInput').value.trim()); updateApiStatus(); closeModal(); showToast("Saved"); }

        function toggleMobileMenu(open) { document.getElementById('mobileMenu').classList.toggle('open', open); document.getElementById('menuOverlay').classList.toggle('hidden', !open); }

        function fillDreamFromCard(el) {
            const dreamText = el.querySelector('p').innerText;
            document.getElementById('dreamInput').value = dreamText;
            navigateTo('home');
            showToast("Dream Copied!");
        }

        function searchDict() {
            const q = document.getElementById('dictSearch').value.toLowerCase().trim();
            document.querySelectorAll('.dict-card').forEach(c => {
                const keywords = c.getAttribute('data-keywords') || "";
                const matches = c.innerText.toLowerCase().includes(q) || keywords.toLowerCase().includes(q);
                c.style.display = matches ? 'block' : 'none';
            });
        }

        function setSearch(k) { document.getElementById('dictSearch').value = k; searchDict(); }

        async function triggerSearch() {
            const q = document.getElementById('dictSearch').value.trim();
            if(!q) return;
            const cards = Array.from(document.querySelectorAll('.dict-card'));
            const hasLocalResult = cards.some(c => c.style.display !== 'none' && c.style.display !== '');
            if(!hasLocalResult) await searchSymbolAI(q);
        }

        async function searchSymbolAI(keyword) {
            const container = document.getElementById('aiResultContainer');
            const noResult = document.getElementById('noSearchResult');
            noResult.classList.remove('hidden');
            container.classList.add('hidden');
            container.innerHTML = `<div class="glass-card p-6 rounded-3xl skeleton h-32 opacity-20"></div>`;
            try {
                const prompt = `Define dream symbol "${keyword}" as JSON: {"psych": "", "trad": ""}. Language: ${currentLang}.`;
                const data = await callGeminiAPI(prompt); 
                if (data) {
                    noResult.classList.add('hidden');
                    container.classList.remove('hidden');
                    container.innerHTML = `<div class="glass-card p-8 rounded-3xl border-t-4 border-pink-500/40 animate-fade-in text-left"><h3 class="text-2xl font-serif font-bold text-white mb-4">${keyword}</h3><p class="text-[10px] text-gray-500 uppercase mb-2">Psychology</p><p class="text-gray-300 text-sm mb-4">${data.psych || ""}</p><p class="text-[10px] text-gray-500 uppercase mb-2">Folklore</p><p class="text-gray-300 text-sm">${data.trad || ""}</p></div>`;
                }
            } catch (e) { container.classList.add('hidden'); }
        }
    </script>
</body>
</html>
